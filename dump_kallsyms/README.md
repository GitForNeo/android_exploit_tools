### Usage

1. 确保`adb`, `python`可用
2. 将`boot.img`放入该目录
3. 插入手机
4. 运行`dump-kallsyms.bat | dump-kallsyms.sh`
5. 生成内核符号表文件`kallsyms`

### Example

#### MAC

    $ ./dump_kallsyms.sh

    python bootimg.py --unpack-bootimg
    arguments: [bootimg file]
    bootimg file: boot.img
    output: kernel[.gz] ramdisk[.gz] second[.gz]
    kernel_addr=0x40080000
    ramdisk_addr=0x44000000
    second_addr=0x40f00000
    tags_addr=0x4e000000
    page_size=2048
    name="56"
    cmdline="bootopt=64S3,32N2,64N2"
    padding_size=2048

    rm ramdisk.gz
    rm bootimg.json
    rm unknown

    gzip -d -f kernel.gz
    gzip: kernel.gz: trailing garbage ignored

    adb push kernel data/local/tmp
    7084 KB/s (15970340 bytes in 2.201s)
    adb push kallsymsprint_arm64 data/local/tmp
    2999 KB/s (33056 bytes in 0.010s)

    adb shell < adb-cmd
    cd data/local/tmp

    chmod 777 kallsymsprint_arm64

    ./kallsymsprint_arm64 kernel > kallsyms

    exit


    shell@X3:/ $ cd data/local/tmp
    shell@X3:/data/local/tmp $
    shell@X3:/data/local/tmp $ chmod 777 kallsymsprint_arm64
    shell@X3:/data/local/tmp $
    shell@X3:/data/local/tmp $ ./kallsymsprint_arm64 kernel > kallsyms
    [+]mmap
      mem=7f869c4000 length=00f3b024 offset=ffffff40796bc000
    [+]kallsyms_addresses=ffffffc000b58200
      count=0001127c
    [+]kallsyms_num_syms=0001127c
    [+]kallsyms_names=ffffffc000be1700
    [+]kallsyms_markers=ffffffc000cb5800
    [+]kallsyms_token_table=ffffffc000cb6100
    [+]kallsyms_token_index=ffffffc000cb6500
    [+]kallsyms_lookup_name
    shell@X3:/data/local/tmp $
    shell@X3:/data/local/tmp $ exit

    adb pull data/local/tmp/kallsyms kallsyms
    9291 KB/s (2764918 bytes in 0.290s)


#### Windows
	D:\work\github\magic_lamp\dump_kallsyms.bat
	
    D:\work\github\magic_lamp\dump_kallsyms>python bootimg.py --unpack-bootimg
    arguments: [bootimg file]
    bootimg file: boot.img
    output: kernel[.gz] ramdisk[.gz] second[.gz]
    kernel_addr=0x40080000
    ramdisk_addr=0x44000000
    second_addr=0x40f00000
    tags_addr=0x4e000000
    page_size=2048
    name="V6.7.5.0.LHMCNC"
    cmdline="bootopt=64S3,32N2,64N2"
    padding_size=2048

    D:\work\github\magic_lamp\dump_kallsyms>del ramdisk.gz

    D:\work\github\magic_lamp\dump_kallsyms>del bootimg.json

    D:\work\github\magic_lamp\dump_kallsyms>7z.exe x -tgzip kernel.gz -y

    7-Zip [64] 9.20  Copyright (c) 1999-2010 Igor Pavlov  2010-11-18

    Processing archive: kernel.gz

    Extracting  kernel

    Everything is Ok

    Size:       15040548
    Compressed: 6612298

    D:\work\github\magic_lamp\dump_kallsyms>del kernel.gz

    D:\work\github\magic_lamp\dump_kallsyms>adb push kernel data/local/tmp
    6468 KB/s (15040548 bytes in 2.270s)

    D:\work\github\magic_lamp\dump_kallsyms>adb push kallsymsprint_arm64 data/local/tmp
    2481 KB/s (33056 bytes in 0.013s)

    D:\work\github\magic_lamp\dump_kallsyms>adb shell  0<adb-cmd
    cd data/local/tmp

    chmod 777 kallsymsprint_arm64

    ./kallsymsprint_arm64 kernel > kallsyms

    exit


    shell@hermes:/ $ cd data/local/tmp
    shell@hermes:/data/local/tmp $
    shell@hermes:/data/local/tmp $ chmod 777 kallsymsprint_arm64
    shell@hermes:/data/local/tmp $
    shell@hermes:/data/local/tmp $ ./kallsymsprint_arm64 kernel > kallsyms
    [+]mmap
      mem=7f9b882000 length=00e58024 offset=ffffff40647fe000
    [+]kallsyms_addresses=ffffffc000aced00
      count=0000e552
    [+]kallsyms_num_syms=0000e552
    [+]kallsyms_names=ffffffc000b41900
    [+]kallsyms_markers=ffffffc000bed500
    [+]kallsyms_token_table=ffffffc000bedd00
    [+]kallsyms_token_index=ffffffc000bee100
    [+]kallsyms_lookup_name
    shell@hermes:/data/local/tmp $
    shell@hermes:/data/local/tmp $ exit

    D:\work\github\magic_lamp\dump_kallsyms>adb pull data/local/tmp/kallsyms kallsyms
    4770 KB/s (2199892 bytes in 0.450s)

    D:\work\github\magic_lamp\dump_kallsyms>del kernel

    D:\work\github\magic_lamp\dump_kallsyms>pause
    请按任意键继续. . .