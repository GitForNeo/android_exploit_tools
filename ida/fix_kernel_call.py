#!/usr/bin/env python
# encoding: utf-8
"""
@author:     idhyt@hotmail.com
@date:
@description:
            fix kernel call
"""

from idc import *


kallsyms_file_path = ""


def fix_kallsyms(file_name):
    with open(file_name, "r") as f:
        kallsyms_lines = f.readlines()

    for line in kallsyms_lines:
        address = long(line.split(" ")[0].rstrip(), 16)
        name = line.split(" ")[-1].rstrip()
        # print "0x%lx %s" % (address, name)
        MakeName(address, name)
    f.close()


if not kallsyms_file_path:
    kallsyms_file_path = AskFile(0, "*", "Select kernel kallsyms file")

fix_kallsyms(kallsyms_file_path)

