import idaapi
import struct


def dumpdex(start, len, target):
    rawdex = idaapi.dbg_read_memory(start, len)
    fd = open(target, 'wb')
    fd.write(rawdex)
    fd.close()

def getdexlen(start):
    pos = start + 0x20
    mem = idaapi.dbg_read_memory(pos, 4)
    len = struct.unpack('<I', mem)[0]
    # print 'len is ' + str(hex(len))
    return int(len)


start = AskAddr(0, 'Input DexFile start in hex: ')
print('start is ' + str(hex(start)))

len = AskLong(getdexlen(start), 'Input DexFile len in hex: ')
print('len is ' + str(hex(len)))


target = AskStr('/users/idhyt/temp/%s.dex' % str(hex(start)), 'Input the dump file path')


if len > 0x0 and start > 0x0 and target and AskYN(1, 'start is 0x%0x, len is 0x%x, dump to %s' % (start, len, target)) == 1:
    dumpdex(start, len, target)
print('Dump Finish')