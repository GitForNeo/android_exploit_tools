#!/usr/bin/env python
# encoding: utf-8
"""
@author:     idhyt@hotmail.com
@date:
@description:
            rename
"""

from idc import *

_TYPE = 0


syms_file_path = ""


def fix_kallsyms(file_name):
    with open(file_name, "r") as f:
        kallsyms_lines = f.readlines()

    for line in kallsyms_lines:
        address = long(line.split(" ")[0].rstrip(), 16)
        name = line.split(" ")[-1].rstrip()
        # print "0x%lx %s" % (address, name)
        MakeName(address, name)
    f.close()


def fix_str_name(file_name):
    regex = r"\:(.+)\s(a.+)\sDCB"
    pattern = re.compile(regex, re.IGNORECASE)

    with open(file_name, "r") as f:
        str_name_lines = f.readlines()

    for str_name_line in str_name_lines:
        result = pattern.findall(str_name_line)
        if result and len(result) > 0:
            print "0x%x %s" % (long(result[0][0], 16), result[0][1])
            MakeName(long(result[0][0], 16), result[0][1])

    f.close()


if not syms_file_path:
    syms_file_path = AskFile(0, "*", "Select syms file")

if _TYPE == 1:
    fix_kallsyms(syms_file_path)

else if _TYPE == 2:
    fix_str_name(syms_file_path)

else:
    print "TYPE error!"

print "ok."
